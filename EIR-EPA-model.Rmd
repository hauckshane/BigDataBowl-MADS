---
title: "Edge Intensity Rating"
author: "Shane Hauck, Marion Haney, Devin Basley, Vinay Maruri"
date: "2024-1-8"
output: html_document
---

File for investigating linear and statistical relationships between EIR and EPA of plays.

Load in packages.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
theme_set(theme_bw())
```


Load data.
```{r}
maxChangesEIR <- read.csv("data/BC_and_ES_information.csv")
```


# The only requirements to run this code are the stargazer package. The stargazer package is used to create a nice looking table of regression results.
```{r}
library(stargazer)
```

#The relationship that we're interested in modelling is between expected points added (EPA) and the edge intensity rating (EIR). 

#The data used in this model was generated by Edge-Intensity-Rating.Rmd. The dataset contains computed information about the EPA, EIR, and play level information for 2,137 plays from the first 9 weeks of the 2022 season. 

```{r}
maxChangesEIR <- read.csv("data/BC_and_ES_information.csv")
```

#To test for different specifications of the relationship between EIR and EPA, we create a new variable that is the square root of EPA. This variable is used in the first model. The second model uses an untransformed EPA as the dependent variable. The third model uses the log of EPA as the dependent variable. The fourth model uses the square of EPA as the dependent variable. The fifth model uses the reciprocal of EPA as the dependent variable.


# Model 1: Square Root of EPA as Dependent Variable

```{r}
maxChangesEIR <- maxChangesEIR %>%
  mutate(relative_sqrtEPA = ifelse(expectedPointsAdded < 0, -sqrt(abs(expectedPointsAdded)), sqrt(expectedPointsAdded)))

mod1 <- lm(relative_sqrtEPA ~ max_EIR_atMaxChange, data = maxChangesEIR)
summary(mod1)
plot(mod1)
```


# Model 2: Untransformed EPA as Dependent Variable
```{r}
mod2 <- lm(expectedPointsAdded ~ max_EIR_atMaxChange, data = maxChangesEIR)
summary(mod2)
plot(mod2)
```

# Model 3: Log of EPA as Dependent Variable
```{r}
mod3 <- lm(log(expectedPointsAdded) ~ max_EIR_atMaxChange, data = maxChangesEIR)
summary(mod3)
plot(mod3)
```

# Model 4: Square of EPA as Dependent Variable
```{r}
maxChangesEIR <- maxChangesEIR %>%
  mutate(squareEPA = expectedPointsAdded^2)
mod4 <- lm(squareEPA ~ max_EIR_atMaxChange, data = maxChangesEIR)
summary(mod4)
plot(mod4)
```

# Model 5: Reciprocal of EPA as Dependent Variable
```{r}
maxChangesEIR <- maxChangesEIR %>%
  mutate(reciprocalEPA = 1/expectedPointsAdded)
mod5 <- lm(reciprocalEPA ~ max_EIR_atMaxChange, data = maxChangesEIR)
summary(mod5)
plot(mod5)
```

# Based on this analysis, we conclude that the relationship between EIR and EPA is best modeled using the untransformed EPA as the dependent variable. All of the other models exhibit either exhibit more extreme heteroskedasticity, less normally distributed model residuals, a non-linear relationship between EIR and EPA, and/or do not detect a significant relationship between EIR and EPA.

# The stargazer command will generate a nice looking table of regression results using pure latex (that will then be compiled into a human readable table in the final report).

```{r}
stargazer(mod2)
```